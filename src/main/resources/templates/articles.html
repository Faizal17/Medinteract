<!DOCTYPE html>
<html lang="en">
<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title> Medinteract</title>
		
		<link rel="stylesheet" type="text/css" href="static/style.css">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
					integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
						integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
						crossorigin="anonymous"></script>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
		<script src="https://code.jquery.com/jquery-3.6.3.min.js"
						integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"
						integrity="sha512-1QvjE7BtotQjkq8PxLeF6P46gEpBRXuskzIVgjFpekzFVF4yjRgrQvTG1MTOJ3yQgvTteKAcO7DSZI92+u/yZw=="
						crossorigin="anonymous" referrerpolicy="no-referrer"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"
						integrity="sha512-iKDtgDyTHjAitUDdLljGhenhPwrbBfqTKWO1mkhSFH3A7blITC9MhYon6SjnMhp4o0rADGw9yAC6EW4t5a4K3g=="
						crossorigin="anonymous" referrerpolicy="no-referrer"></script>
		<link rel="stylesheet" href="https://kendo.cdn.telerik.com/2023.1.117/styles/kendo.default-ocean-blue.min.css"/>
		<script src="https://kendo.cdn.telerik.com/2023.1.117/js/kendo.all.min.js"></script>
		<script type="text/javascript" src="static/script.js"></script>
</head>
<body>
<div id="navDiv"></div>
<div id="contentDiv">
		<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
				Launch demo modal
		</button>
		
		<!-- Modal -->
		<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
				<div class="modal-dialog modal-xl">
						<div class="modal-content">
								<div class="modal-header">
										<h1 class="modal-title fs-5" id="exampleModalLabel">Modal title</h1>
										<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
								</div>
								<div class="modal-body">
										<form id="form" method="post" enctype="multipart/form-data">
												<div class="form-group row my-3">
														<label class="col-md-3 col-form-label text-md-left">Article Title</label>
														<div class="col-md-9">
																<input type="text" class="form-control" name="title" id="title" required>
														</div>
												</div>
												<div class="form-group row my-3">
														<label class="col-md-3 col-form-label text-md-left">Cover Image</label>
														<div class="col-md-9">
																<input type="file" accept="image/*" name="cover_image" required>
														</div>
												</div>
												<div class="form-group row my-3">
														<label class="col-md-3 col-form-label text-md-left">Content</label>
														<div class="col-md-9">
																<div class="demo-section k-content wide">
																			<textarea id="editor" name="editor" rows="10" cols="30"
																								style="width:100%;height:27vw" aria-label="editor">
																			</textarea>
																</div>
														</div>
												</div>
												<div class="modal-footer">
														<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
														<button class="btn btn-primary" type="submit" name="submit" id="submit_btn">
																Save article
														</button>
												</div>
										</form>
								</div>
						</div>
				</div>
		</div>
</div>
</body>
</html>

<script>
		let editor = $("#editor").kendoEditor({
				tools: [
						"bold",
						"italic",
						"underline",
						"undo",
						"redo",
						"justifyLeft",
						"justifyCenter",
						"justifyRight",
						"insertUnorderedList",
						"createLink",
						"unlink",
						"insertImage",
						"tableWizard",
						"createTable",
						"addRowAbove",
						"addRowBelow",
						"addColumnLeft",
						"addColumnRight",
						"deleteRow",
						"deleteColumn",
						"mergeCellsHorizontally",
						"mergeCellsVertically",
						"splitCellHorizontally",
						"splitCellVertically",
						"tableAlignLeft",
						"tableAlignCenter",
						"tableAlignRight",
						"formatting",
						{
								name: "fontName",
								items: [{
										text: "Andale Mono",
										value: "\"Andale Mono\""
								}, // Font-family names composed of several words should be wrapped in \" \"
										{
												text: "Arial",
												value: "Arial"
										},
										{
												text: "Arial Black",
												value: "\"Arial Black\""
										},
										{
												text: "Book Antiqua",
												value: "\"Book Antiqua\""
										},
										{
												text: "Comic Sans MS",
												value: "\"Comic Sans MS\""
										},
										{
												text: "Courier New",
												value: "\"Courier New\""
										},
										{
												text: "Georgia",
												value: "Georgia"
										},
										{
												text: "Helvetica",
												value: "Helvetica"
										},
										{
												text: "Impact",
												value: "Impact"
										},
										{
												text: "Symbol",
												value: "Symbol"
										},
										{
												text: "Tahoma",
												value: "Tahoma"
										},
										{
												text: "Terminal",
												value: "Terminal"
										},
										{
												text: "Times New Roman",
												value: "\"Times New Roman\""
										},
										{
												text: "Trebuchet MS",
												value: "\"Trebuchet MS\""
										},
										{
												text: "Verdana",
												value: "Verdana"
										},
								]
						},
						"fontSize",
						"foreColor",
						"backColor",
				]
		});
		
		const form = document.getElementById('form');
		form.addEventListener('submit', submitForm);
		
		function submitForm(event) {
				event.preventDefault();
				$("#submit_btn").prop('disabled', true)
				let data = {};
				data["doctorId"] = getCookie("id");
				data["title"] = $("#title").val();
				// data["content"] = editor.data("kendoEditor").value();
				data["createdDate"] = new Date().toJSON().split('.')[0].replace('T', ' ');
				const fileInput = document.querySelector('input[type="file"]');
				let file = fileInput.files[0]; // get the first file from the input
				const formData = new FormData();
				formData.append('coverImage', file); // add the file to the form data
				formData.append('objectData', JSON.stringify(data));
				formData.append('content', editor.data("kendoEditor").value());
				console.log(formData)
				$.ajax({
						url: globalURL + "article/addArticle",
						type: 'POST',
						processData: false,
						contentType: false,
						data: formData
				}).done(function (response) {
						try {
								if (!response.is_error) {
										alert('Blog added successfully !');
										// window.open('./view.php','_self');
								} else {
										alert(response.message);
										$("#submit_btn").prop('disabled', false);
								}
						} catch (err) {
								$("#submit_btn").prop('disabled', false);
								alert("An error occured, Please try again!", err);
						}
				}).fail(function (jqXHR, textStatus, errorThrown) {
						$("#submit_btn").prop('disabled', false);
						alert(textStatus + " while saving blog");
				});
		}
</script>